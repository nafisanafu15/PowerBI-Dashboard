{% extends "global_layout.html" %}

{% block title %}Managerial Dashboard â€“ Offer Expiry Surge{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
{% endblock %}

{% block content %}
<div class="report-main container-fluid">
  <div class="row g-3">
    <aside class="filters-panel col-lg-2">
      <h3 class="mb-3">Filters</h3>
      <div class="mb-3 time-filter">
        <label class="form-label fw-bold">Time Period</label>
        <div class="radio-group d-flex flex-column">
          <label><input type="radio" name="time" value="today"> Today</label>
          <label><input type="radio" name="time" value="week"> This week</label>
          <label><input type="radio" name="time" value="month"> This month</label>
          <label><input type="radio" name="time" value="year"> This year</label>
          <label><input type="radio" name="time" value="custom"> Set up</label>
        </div>
        <div class="date-range">
          <input type="text" class="time-range form-control form-control-sm" placeholder="Select range">
          <div class="mt-2">
            <button type="button" class="btn btn-outline-primary btn-sm rounded-pill apply-range">Apply</button>
            <button type="button" class="btn btn-outline-secondary btn-sm rounded-pill cancel-range">Cancel</button>
          </div>
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label fw-bold">Sort By</label>
        <div class="d-flex flex-wrap gap-2 mb-2">
          <button class="btn btn-outline-primary btn-sm sort-field" data-field="OfferId">Offer ID</button>
          <button class="btn btn-outline-primary btn-sm sort-field" data-field="Status">Offer Status</button>
          <button class="btn btn-outline-primary btn-sm sort-field" data-field="CourseManager">Course Manager</button>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-outline-primary btn-sm sort-order" data-order="asc">Ascending</button>
          <button class="btn btn-outline-primary btn-sm sort-order" data-order="desc">Descending</button>
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label fw-bold">Semester/Intake</label>
        <div class="d-flex flex-wrap gap-2 intake-buttons">
          <button class="btn btn-outline-primary btn-sm intake" data-sem="Trimester 1">Trimester 1</button>
          <button class="btn btn-outline-primary btn-sm intake" data-sem="Trimester 2">Trimester 2</button>
          <button class="btn btn-outline-primary btn-sm intake" data-sem="Trimester 3">Trimester 3</button>
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label fw-bold">Course Manager</label>
        <input id="managerFilter" type="text" class="form-control form-control-sm" placeholder="Manager name">
      </div>
      <div class="mb-3">
        <label class="form-label fw-bold">Offer ID</label>
        <input id="offerIdFilter" type="text" class="form-control form-control-sm" placeholder="e.g. 123">
      </div>
      <div class="mb-3">
        <label class="form-label fw-bold">Status</label>
        <div class="form-check">
          <input class="form-check-input status-filter" type="checkbox" value="Offered" id="statOffered">
          <label class="form-check-label" for="statOffered">Offered</label>
        </div>
        <div class="form-check">
          <input class="form-check-input status-filter" type="checkbox" value="Accepted" id="statAccepted">
          <label class="form-check-label" for="statAccepted">Accepted</label>
        </div>
        <div class="form-check">
          <input class="form-check-input status-filter" type="checkbox" value="Rejected" id="statRejected">
          <label class="form-check-label" for="statRejected">Rejected</label>
        </div>
        <div class="form-check">
          <input class="form-check-input status-filter" type="checkbox" value="Deferred" id="statDeferred">
          <label class="form-check-label" for="statDeferred">Deferred</label>
        </div>
      </div>
    </aside>

    <section class="report-content col-lg-8">
      <h1 class="mb-3">Managerial Dashboard</h1>
      <h2 class="h5 text-muted mb-4">Upcoming Offer Expiry Surge</h2>
      <canvas id="mainChart" class="mb-4" height="200"></canvas>
      <div id="noData" class="text-center d-none">No data found for selected criteria</div>
      <div class="table-responsive">
        <table id="dataTable" class="table table-bordered table-sm">
          <thead class="table-light">
            <tr><th>Nationality</th><th>Count of Expiring Offers</th><th>Course Title</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <aside class="chart-options col-lg-2">
      <h3 class="mb-3">Graphs and Charts</h3>
      <div class="d-flex flex-column gap-2">
        <button class="btn btn-outline-primary chart-btn active" data-type="bar"><i class="fa-solid fa-chart-column me-1"></i>Bar Chart</button>
        <button class="btn btn-outline-primary chart-btn" data-type="doughnut"><i class="fa-solid fa-circle-notch me-1"></i>Donut Chart</button>
        <button class="btn btn-outline-primary chart-btn" data-type="pie"><i class="fa-solid fa-chart-pie me-1"></i>Pie Chart</button>
        <button class="btn btn-outline-primary chart-btn" data-type="table"><i class="fa-solid fa-table me-1"></i>Table</button>
      </div>
    </aside>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='Js/time_period_filter.js') }}"></script>
<script src="{{ url_for('static', filename='Js/offer_expiry_report.js') }}" defer></script>
{% endblock %}
